{"version":3,"file":"multi-select-min.js","sources":["../src/dom-component.js","../src/defaults.js","../src/multi-select.js"],"sourcesContent":["const d = document;\n\nexport default class DomComponent {\n    constructor(element, options = {}, defaults = {}) {\n        this.options = Object.assign({}, defaults, options);\n\n        this._events = [];\n\n        this.dom = {\n            el: this._setElement(element)\n        };\n    }\n\n    /**\n     * Add/remove the toggling className\n     * @param {Boolean|undefined} show\n     * @return DomComponent\n     */\n    toggle(show = undefined) {\n        let classList = this.dom.el.classList;\n        if (show !== undefined) {\n            classList[show ? 'remove' : 'add']('si-off');\n            return this;\n        }\n        classList.toggle('si-off');\n        return this;\n    }\n\n    /**\n     * Bind a (delegated) event\n     * @param {String} event\n     * @param {Function} fn\n     * @param {HTMLElement|Document} el\n     * @return DomComponent\n     */\n    on(event, fn, el = null) {\n\n        (el || this.dom.el).addEventListener(event, fn = fn.bind(this), true);\n\n        this._events.push({\n            name: event,\n            fn: fn,\n            el: el\n        });\n\n        return this;\n    }\n\n    /**\n     * Return the main wrapping element\n     * @return {Element}\n     */\n    getElement() {\n        return this.dom.el;\n    }\n\n    /**\n     * Unbind all events and nullify references\n     * @return void\n     */\n    remove() {\n        this._events = this._events.filter(event => {\n            return (event.el || this.dom.el).removeEventListener(event.name, event.fn, true);\n        });\n        this.dom.el.parentNode.removeChild(this.dom.el);\n        this.dom = this.options = null;\n    }\n\n    /**\n     * Query the element in the DOM if its a string\n     * @param {Element|String} el\n     * @return {Element|null}\n     * @protected\n     */\n    _setElement(el) {\n        if (!el && !el.nodeType && typeof el !== 'string') {\n            throw new Error('Wrong element type provided!');\n        }\n        if (el.nodeType) return el;\n        return (this.options.parent || d).querySelector(el);\n    }\n\n    /**\n     * Communicate changes\n     * @param {String} name\n     * @param {Object|null} detail\n     * @protected\n     */\n    _trigger(name, detail = null) {\n        let event;\n\n        if (typeof CustomEvent === 'function') {\n            event = new CustomEvent(name, {\n                detail: detail,\n                bubbles: true,\n                cancelable: true\n            });\n        } else {\n            event = d.createEvent('CustomEvent');\n            event.initCustomEvent(name, true, true, detail);\n        }\n\n        this.dom.el.dispatchEvent(event);\n    }\n}\n","export default {\n    items: [],\n    display: 'value',\n    current: null,\n    parent: null,\n    maxHeight: 0,\n    sort: true,\n    order: 'desc',\n    placeholder: 'Select items',\n    more: '(+{X} more)'\n};\n","import DomHelper from './dom-component.js';\nimport defaults from './defaults.js';\n\nconst d = document;\n\nexport default class MultiSelect extends DomHelper {\n    constructor(element, options = {}) {\n        super(element, options, defaults);\n\n        if (this.options.sort) {\n            this.options.items = this._sortItems(options.items);\n        }\n\n        this.options.items = options.items && options.items.length\n            ? this._convertItems(options.items)\n            : [];\n\n        if (options.current && options.current.length) {\n            options.current = this._convertItems(options.current);\n            this._setSelected(options.current);\n        }\n\n        this._renderInit();\n\n        this._setResultMessage();\n\n        this._bindEvents();\n    }\n\n    /**\n     * Bind the delegated dom events\n     * @private\n     */\n    _bindEvents() {\n        // Select or just unfold the options\n        this.on('click', e => {\n            if (e.target.classList.contains('si-item')) return this._setCurrent(e)._setResultMessage();\n            this.toggle();\n        }, this.el);\n\n        // Close the dropdown if the user click outside of it\n        this.on('click', e => {\n            if (!this.dom.el.contains(e.target)) return this.toggle(false);\n        }, d);\n\n        // Fold up the dropdown if the user presses the Escape key\n        this.on('keyup', e => {\n            if (e.key === 'Escape' || e.keyCode === 27) this.toggle(false);\n        }, d);\n    }\n\n    /**\n     * Get all items in the list\n     * @return {Object[]}\n     * @public\n     */\n    getItems() {\n        return Array.from(this.options.items.values());\n    }\n\n    /**\n     * Return the current field value object\n     * @param {string} key Only return a specific value from each current item\n     * @return {[]|null}\n     * @public\n     */\n    getCurrent(key = '') {\n        let items = this.getItems().filter(i => i.selected);\n        return !key ? items : items.map(i => i[key]);\n    }\n\n    /**\n     * @todo do better: setCurrent, _setCurrent & _setSelected ...\n     * @param {*|!object} currents\n     * @public\n     */\n    setCurrent(currents) {\n        const isArray = Array.isArray(currents);\n\n        if (!currents || (isArray && !currents.length)) {\n            return;\n        }\n\n        let items = this.options.items,\n            display = this.options.display;\n\n        currents = isArray ? currents : [currents];\n        currents = this._convertItems(currents);\n\n        currents.forEach(current => {\n            items.forEach((item, key) => {\n                if (item[display] === current[display]) {\n                    this.dom.el.querySelector(`.si-item[data-key=\"${key}\"]`).classList.add('si-selected');\n                    item.selected = true;\n                }\n            });\n        });\n\n        this._setResultMessage();\n    }\n\n    /**\n     * Find an item in the list\n     * @param {HTMLElement|String|Number} item\n     * @return {{}}\n     * @public\n     */\n    findItem(item) {\n        let display = this.options.display;\n        item = item.nodeName ? item.dataset.value : item;\n        return this.options.items.find(i => i[display] === item);\n    }\n\n    /**\n     *\n     * @param {Event} e\n     * @param {boolean} trigger\n     * @private\n     */\n    _setCurrent(e, trigger = true) {\n        let el = e.target,\n            key = parseInt(el.dataset.key, 10),\n            item = this.options.items.get(key);\n\n        item.selected = el.classList.toggle('si-selected');\n        this.options.items.set(key, item);\n        if (trigger) this._trigger('change', item);\n        return this;\n    }\n\n    /**\n     * Loop over the passed array to set selected items\n     * @param {array} currents\n     * @private\n     */\n    _setSelected(currents) {\n        let items = this.options.items,\n            display = this.options.display;\n\n        currents.forEach(current => {\n            items.forEach(item => {\n                if (item[display] === current[display]) {\n                    item.selected = true;\n                }\n            });\n        });\n    }\n\n    /**\n     * Display selection result message\n     * @private\n     */\n    _setResultMessage() {\n        let selection = this.getCurrent(),\n            display = this.options.display,\n            count = selection.length,\n            result = '';\n\n        switch (count) {\n            case 1:\n                result = selection[0][display];\n                break;\n            case 0:\n                result = this.options.placeholder;\n                break;\n            default:\n                result = /({X})/.test(this.options.more)\n                    ? `${selection[0][display]} ${this.options.more.replace('{X}', count - 1)}`\n                    : this.options.more;\n        }\n\n        this.dom.result.classList[count ? 'add' : 'remove']('si-selection');\n        this.dom.result.innerHTML = result;\n    }\n\n    /**\n     * Make an array of object if needed\n     * @todo better 'selected' checking: what if `current` is array of objects\n     * @param {Array} items\n     * @return {Map<Object>}\n     * @private\n     */\n    _convertItems(items = []) {\n        let display = this.options.display,\n            map = new Map(),\n            key = 0;\n\n        items.forEach(item => {\n            if (typeof item !== 'object') item = {[display]: item};\n            map.set(key++, item);\n        });\n\n        return map;\n    }\n\n    /**\n     * Create the HTML upon instantiation\n     * @return {Node}\n     * @private\n     */\n    _renderInit() {\n        let frag = d.createDocumentFragment();\n\n        this.dom.el.classList.add('si-off', 'si-wrap');\n        this.dom.result = frag.appendChild(this._renderResultDiv());\n\n        frag.appendChild(this._renderList());\n        return this.dom.el.appendChild(frag);\n    }\n\n    /**\n     * Create the selection result element\n     * @return {HTMLElement}\n     * @private\n     */\n    _renderResultDiv() {\n        let el = d.createElement('div');\n        el.className = 'si-result';\n        return el;\n    }\n\n    /**\n     * Create the list element\n     * @return {HTMLElement}\n     * @private\n     */\n    _renderList() {\n        let wrap = d.createElement('div'),\n            el = d.createElement('ul'),\n            maxHeight = this.options.maxHeight;\n\n        wrap.className = 'si-list';\n\n        if (maxHeight) wrap.style.maxHeight = maxHeight + 'px';\n\n        el.innerHTML = this._renderListItems();\n\n        wrap.appendChild(el);\n\n        return wrap;\n    }\n\n    /**\n     * Create the list items\n     * @return {String}\n     * @private\n     */\n    _renderListItems() {\n        let items = this.options.items,\n            display = this.options.display,\n            list = '',\n            selected;\n\n        items.forEach((item, key) => {\n            selected = item.selected ? ' si-selected' : '';\n            list += `<li class=\"si-item${selected}\" data-key=\"${key}\">${item[display]}</li>`;\n        });\n\n        return list;\n    }\n\n    /**\n     * Rearrange the list\n     * @private\n     */\n    _sortItems() {\n        let order = this.options.order === 'desc' ? 1 : -1,\n            display = this.options.display;\n        this.options.items.sort((a, b) => {\n            if (a[display] < b[display]) return -order;\n            if (a[display] > b[display]) return order;\n            return 0;\n        });\n    }\n}\n"],"names":["d","document","items","display","current","parent","maxHeight","sort","order","placeholder","more","[object Object]","element","options","defaults","this","Object","assign","_events","dom","el","_setElement","show","classList","undefined","toggle","event","fn","addEventListener","bind","push","name","filter","removeEventListener","parentNode","removeChild","nodeType","Error","querySelector","detail","CustomEvent","bubbles","cancelable","createEvent","initCustomEvent","dispatchEvent","super","_sortItems","length","_convertItems","_setSelected","_renderInit","_setResultMessage","_bindEvents","on","e","target","contains","_setCurrent","key","keyCode","Array","from","values","getItems","i","selected","map","currents","isArray","forEach","item","add","nodeName","dataset","value","find","trigger","parseInt","get","set","_trigger","selection","getCurrent","count","result","test","replace","innerHTML","Map","frag","createDocumentFragment","appendChild","_renderResultDiv","_renderList","createElement","className","wrap","style","_renderListItems","list","a","b"],"mappings":"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"}