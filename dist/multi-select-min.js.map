{"version":3,"file":"multi-select-min.js","sources":["../src/dom-component.js","../src/defaults.js","../src/multi-select.js"],"sourcesContent":["const d = document;\r\n\r\nexport default class DomComponent {\r\n    constructor(element, options = {}, defaults = {}) {\r\n        this.options = Object.assign({}, defaults, options);\r\n\r\n        this._events = [];\r\n\r\n        this.dom = {\r\n            el: this._setElement(element)\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Add/remove the toggling className\r\n     * @param {Boolean|undefined} show\r\n     * @return DomComponent\r\n     */\r\n    toggle(show = undefined) {\r\n        let classList = this.dom.el.classList;\r\n        if (show !== undefined) {\r\n            classList[show ? 'remove' : 'add']('si-off');\r\n            return this;\r\n        }\r\n        classList.toggle('si-off');\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Bind a (delegated) event\r\n     * @param {String} event\r\n     * @param {Function} fn\r\n     * @param {HTMLElement|Document} el\r\n     * @return DomComponent\r\n     */\r\n    on(event, fn, el = null) {\r\n\r\n        (el || this.dom.el).addEventListener(event, fn = fn.bind(this), true);\r\n\r\n        this._events.push({\r\n            name: event,\r\n            fn: fn,\r\n            el: el\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Return the main wrapping element\r\n     * @return {Element}\r\n     */\r\n    getElement() {\r\n        return this.dom.el;\r\n    }\r\n\r\n    /**\r\n     * Unbind all events and nullify references\r\n     * @return void\r\n     */\r\n    remove() {\r\n        this._events = this._events.filter(event => {\r\n            return (event.el || this.dom.el).removeEventListener(event.name, event.fn, true);\r\n        });\r\n        this.dom.el.parentNode.removeChild(this.dom.el);\r\n        this.dom = this.options = null;\r\n    }\r\n\r\n    /**\r\n     * Query the element in the DOM if its a string\r\n     * @param {Element|String} el\r\n     * @return {Element|null}\r\n     * @protected\r\n     */\r\n    _setElement(el) {\r\n        if (!el && !el.nodeType && typeof el !== 'string') {\r\n            throw new Error('Wrong element type provided!');\r\n        }\r\n        if (el.nodeType) return el;\r\n        return (this.options.parent || d).querySelector(el);\r\n    }\r\n\r\n    /**\r\n     * Communicate changes\r\n     * @param {String} name\r\n     * @param {Object|null} detail\r\n     * @protected\r\n     */\r\n    _trigger(name, detail = null) {\r\n        let event;\r\n\r\n        if (typeof CustomEvent === 'function') {\r\n            event = new CustomEvent(name, {\r\n                detail: detail\r\n            });\r\n        } else {\r\n            event = d.createEvent('Event');\r\n            event.initEvent(name, true, true);\r\n        }\r\n\r\n        this.dom.el.dispatchEvent(event);\r\n    }\r\n}\r\n","export default {\r\n    items: [],\r\n    display: 'value',\r\n    current: null,\r\n    parent: null,\r\n    maxHeight: 0,\r\n    sort: true,\r\n    order: 'desc',\r\n    placeholder: 'Select items',\r\n    more: '(+{X} more)'\r\n};\r\n","import DomHelper from './dom-component.js';\nimport defaults from './defaults.js';\n\nconst d = document;\n\nexport default class MultiSelect extends DomHelper {\n    constructor(element, options = {}) {\n        super(element, options, defaults);\n\n        if (this.options.sort) {\n            this.options.items = this._sortItems(options.items);\n        }\n\n        this.options.items = this._convertItems(options.items, options.current || []);\n\n        this._renderInit();\n\n        this._setResultMessage();\n\n        this._bindEvents();\n    }\n\n    /**\n     * Bind the delegated dom events\n     * @private\n     */\n    _bindEvents() {\n        this.on('keyup', e => {\n            if (e.key === 'Escape' || e.keyCode === 27) this.toggle(false);\n        }, d);\n\n        this.on('click', e => {\n            if (e.target.classList.contains('si-item')) return this._setCurrent(e)._setResultMessage();\n            if (!this.dom.el.contains(e.target)) return this.toggle(false);\n            this.toggle();\n        }, d);\n    }\n\n    /**\n     * Get all items in the list\n     * @return {Object[]}\n     */\n    getItems() {\n        return Array.from(this.options.items.values());\n    }\n\n    /**\n     * Return the current field value object\n     * @return {[]|null}\n     */\n    getCurrent() {\n        return this.getItems().filter(item => item.selected);\n    }\n\n    /**\n     * Find an item in the list\n     * @param {HTMLElement|String|Number} item\n     * @return {{}}\n     */\n    findItem(item) {\n        let display = this.options.display;\n        item = item.nodeName ? item.dataset.value : item;\n        return this.options.items.find(i => i[display] === item);\n    }\n\n    /**\n     *\n     * @param e\n     * @private\n     */\n    _setCurrent(e) {\n        let el = e.target,\n            key = parseInt(el.dataset.key, 10),\n            item = this.options.items.get(key);\n\n        item.selected = el.classList.toggle('si-selected');\n        this.options.items.set(key, item);\n        this._trigger('change', item);\n        return this;\n    }\n\n    /**\n     *\n     * @private\n     */\n    _setResultMessage() {\n        let selection = this.getCurrent(),\n            display = this.options.display,\n            count = selection.length,\n            result = '';\n\n        switch (count) {\n            case 1:\n                result = selection[0][display];\n                break;\n            case 0:\n                result = this.options.placeholder;\n                break;\n            default:\n                result = `${selection[0][display]} ${this.options.more.replace('{X}', count - 1)}`;\n        }\n\n        this.dom.result.classList[count ? 'add' : 'remove']('si-selection');\n        this.dom.result.innerHTML = result;\n    }\n\n    /**\n     * Make an array of object if needed\n     * @todo better 'selected' checking: what if `current` is array of objects\n     * @param {Array} items\n     * @param {*} current\n     * @return {Map<Object>}\n     * @private\n     */\n    _convertItems(items = [], current = null) {\n        let display = this.options.display,\n            map = new Map(),\n            key = 0;\n\n        items.forEach(item => {\n            if (typeof item !== 'object') {\n                item = {[display]: item};\n            }\n            item.selected = item[display] === current || current.indexOf(item[display]) > -1;\n            map.set(key++, item);\n        });\n\n        return map;\n    }\n\n    /**\n     * Create the HTML upon instantiation\n     * @return {Node}\n     * @private\n     */\n    _renderInit() {\n        let frag = d.createDocumentFragment();\n\n        this.dom.el.classList.add('si-off', 'si-wrap');\n        this.dom.result = frag.appendChild(this._renderResultDiv());\n\n        frag.appendChild(this._renderList());\n        return this.dom.el.appendChild(frag);\n    }\n\n    /**\n     * Create the selection result element\n     * @return {HTMLElement}\n     * @private\n     */\n    _renderResultDiv() {\n        let el = d.createElement('div');\n        el.className = 'si-result';\n        return el;\n    }\n\n    /**\n     * Create the list element\n     * @return {HTMLElement}\n     * @private\n     */\n    _renderList() {\n        let wrap = d.createElement('div'),\n            el = d.createElement('ul'),\n            maxHeight = this.options.maxHeight;\n\n        wrap.className = 'si-list';\n\n        if (maxHeight) wrap.style.maxHeight = maxHeight + 'px';\n\n        el.innerHTML = this._renderListItems();\n\n        wrap.appendChild(el);\n\n        return wrap;\n    }\n\n    /**\n     * Create the list items\n     * @return {String}\n     * @private\n     */\n    _renderListItems() {\n        let items = this.options.items,\n            display = this.options.display,\n            list = '',\n            selected;\n\n        items.forEach((item, key) => {\n            selected = item.selected ? ' si-selected' : '';\n            list += `<li class=\"si-item${selected}\" data-key=\"${key}\">${item[display]}</li>`;\n        });\n\n        return list;\n    }\n\n    /**\n     * Rearrange the list\n     * @private\n     */\n    _sortItems() {\n        let order = this.options.order === 'desc' ? 1 : -1,\n            display = this.options.display;\n        this.options.items.sort((a, b) => {\n            if (a[display] < b[display]) return -order;\n            if (a[display] > b[display]) return order;\n            return 0;\n        });\n    }\n}\n"],"names":["d","document","DomComponent","[object Object]","element","options","defaults","this","Object","assign","_events","dom","el","_setElement","show","classList","undefined","toggle","event","fn","addEventListener","bind","push","name","filter","removeEventListener","parentNode","removeChild","nodeType","Error","parent","querySelector","detail","CustomEvent","createEvent","initEvent","dispatchEvent","items","display","current","maxHeight","sort","order","placeholder","more","DomHelper","super","_sortItems","_convertItems","_renderInit","_setResultMessage","_bindEvents","on","e","key","keyCode","target","contains","_setCurrent","Array","from","values","getItems","item","selected","nodeName","dataset","value","find","i","parseInt","get","set","_trigger","selection","getCurrent","count","length","result","replace","innerHTML","map","Map","forEach","indexOf","frag","createDocumentFragment","add","appendChild","_renderResultDiv","_renderList","createElement","className","wrap","style","_renderListItems","list","a","b"],"mappings":"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"}